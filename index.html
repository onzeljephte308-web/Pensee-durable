<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pens√©e Durable - ONG √âcologique</title>
  <style>
    :root{
      --brand:#2f7a3a;
      --bg:#f5f4e8;
      --card:#ffffff;
      --muted:#6b7a68;
      --line:#d7e7cf;
      --text:#243226;
    }
    [data-theme="dark"]{
      --brand:#4caf50;
      --bg:#121412;
      --card:#1b1f1b;
      --muted:#9aa795;
      --line:#2a2f2a;
      --text:#e6efe6;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
      background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;
    }

    /* Header */
    header{
      background:linear-gradient(90deg,var(--brand),#3d8a47);
      color:#fff; padding:14px 18px; display:flex; align-items:center; justify-content:space-between;
      gap:16px; flex-wrap:wrap;
    }
    .logo { display:flex; align-items:center; gap:10px; }
    .logo img{ height:52px; border-radius:8px; }
    .site-title{ font-weight:700; font-size:1.1rem; letter-spacing:.2px; }
    nav ul{ list-style:none; margin:0; padding:0; display:flex; gap:12px; align-items:center; }
    nav a{ color:inherit; text-decoration:none; font-weight:600; font-size:.95rem; opacity:.95; }
    .controls{ display:flex; gap:8px; align-items:center; }

    /* Hero */
    #hero{ background:#dbe9d3; text-align:center; padding:46px 18px; }
    #hero h1{ margin:0 0 8px; font-size:1.6rem; }
    #hero p{ margin:0; color:#345235; }

    main{ max-width:1000px; margin:18px auto; padding:0 12px; }

    section{ margin-bottom:26px; }
    h2{ margin:0 0 12px; border-bottom:2px solid var(--brand); padding-bottom:8px; display:inline-block; }

    /* Gallery small */
    .gallery{ display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:12px; margin-top:12px; }
    .gallery img, .gallery video{ width:100%; border-radius:10px; display:block; }

    /* Post card */
    .post{
      background:var(--card); border:1px solid #e7efe3; padding:14px; border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,.04); margin-bottom:18px;
    }
    [data-theme="dark"] .post{ border-color:var(--line); box-shadow:none; }
    .post-header{ color:var(--muted); font-size:.9rem; margin-bottom:6px; display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .post h3{ margin:6px 0 8px; font-size:1.05rem; }
    .post p{ margin:8px 0; line-height:1.45; white-space:pre-wrap; }
    .post img, .post video{ width:100%; border-radius:10px; margin-top:10px; }

    .post-actions{ display:flex; flex-wrap:wrap; gap:8px; margin-top:12px; border-top:1px solid #f0f5ee; padding-top:10px; }
    .btn{ padding:8px 12px; border-radius:10px; border:1px solid var(--line); background:transparent; cursor:pointer; font-weight:600; color:var(--text); }
    .btn.primary{ background:var(--brand); color:#fff; border-color:transparent; }
    .btn:disabled{ opacity:.6; cursor:default; }

    .comments{ margin-top:12px; }
    .comment{ background:#f2f6f2; padding:8px 10px; border-radius:8px; margin-top:8px; }
    [data-theme="dark"] .comment{ background:#172017; }

    .comment-form{ display:flex; gap:8px; margin-top:10px; }
    .comment-form input{ flex:1; padding:8px 10px; border-radius:8px; border:1px solid #dfece0; background:transparent; color:inherit; }

    /* Admin panel (exclusive) */
    #admin-panel{
      background:linear-gradient(135deg,#eef7ea,#f6fbf5);
      border:1px solid #dfead9; padding:16px; border-radius:12px; display:none;
      box-shadow:0 10px 24px rgba(47,122,58,0.06);
    }
    #admin-panel .admin-grid{ display:grid; gap:8px; grid-template-columns:1fr; }
    #admin-panel input[type="text"], #admin-panel input[type="url"], #admin-panel input[type="email"], #admin-panel input[type="password"], #admin-panel textarea{
      width:100%; padding:10px; border-radius:8px; border:1px solid #dfece0; font-size:0.95rem;
    }

    /* Admin management */
    .admin-management{ margin-top:12px; border-top:1px dashed #e2eedf; padding-top:12px; }
    .admin-list{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
    .admin-badge{ background:#fff; border:1px solid #e0e8df; padding:6px 10px; border-radius:999px; display:flex; gap:8px; align-items:center; font-weight:600; }

    /* Footer styled */
    footer{
      margin-top:30px;
      background:linear-gradient(135deg,#eef3ea,#eaf6ec);
      padding:18px; border-top:2px solid #e0eadb;
    }
    .footer-inner{ max-width:1000px; margin:0 auto; display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .footer-brand{ display:flex; gap:12px; align-items:center; }
    .footer-brand .badge{ background:#fff; color:var(--brand); padding:6px 10px; border-radius:999px; font-weight:700; border:1px solid #e3efe0; }
    .footer-contact{ color:var(--muted); font-weight:600; }

    /* small screens */
    @media (max-width:720px){
      .post-actions{ justify-content:flex-start; }
      .footer-inner{ flex-direction:column; align-items:flex-start; gap:6px; }
    }
  </style>
</head>
<body data-theme="light">
  <header>
    <div class="logo">
      <img src="logo-pensee-durable.png" alt="logo" onerror="this.style.display='none'">
      <div>
        <div class="site-title">Pens√©e Durable</div>
        <div style="font-size:.85rem; opacity:.9">Ensemble, pensons et b√¢tissons un avenir durable.</div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" onclick="toggleTheme()">üåì Mode</button>
      <nav>
        <ul>
          <li style="display:inline"><a href="#institutionnel">Institutionnel</a></li>
          <li style="display:inline"><a href="#realisation">R√©alisations</a></li>
          <li style="display:inline"><a href="#communautaire">Communautaire</a></li>
        </ul>
      </nav>
      <button class="btn" onclick="openLogin()">üîë Se connecter</button>
    </div>
  </header>

  <section id="hero">
    <h1>Bienvenue sur le site officiel de l'ONG Pens√©e Durable</h1>
    <p>Pour notre avenir,  pensons durable.</p>
  </section>

  <main>
    <section id="institutionnel">
      <h2>Pr√©sentation de l'ONG</h2>
      <article>
        <h3>Vision</h3>
        <p>Former une g√©n√©ration congolaise responsable, o√π chaque citoyen pense, agit et d√©cide en int√©grant l‚Äôenvironnement et les principes du d√©veloppement durable dans ses choix quotidiens.</p>
        <h3>Mission</h3>
        <p>Pour concr√©tiser notre vision, Pens√©e Durable s'articule autour de quatre missions essentielles
<p>- √âduquer les citoyens aux enjeux environnementaux</p>
<p>- Sensibiliser √† l‚Äôimportance de la durabilit√©</p> 
<p>- Former aux bonnes pratiques √©cologiques</p> 
<p>- Accompagner les initiatives vertes et citoyennes</p></p>
      </article>
    </section>

    <section id="realisation">
      <h2>R√©alisations</h2>
      <div class="gallery">
        <img src="img/reforestation.jpg" alt="reforestation" onerror="this.style.display='none'">
        <img src="img/sensibilisation.jpg" alt="sensibilisation" onerror="this.style.display='none'">
      </div>
    </section>

    <section id="communautaire">
      <h2>Publications Communautaires</h2>
      <div id="posts"></div>

      <!-- Admin Panel (exclusif) -->
      <div id="admin-panel" aria-hidden="true">
        <h3>Nouvelle publication (admin)</h3>
        <div class="admin-grid">
          <input id="titre" type="text" placeholder="Titre">
          <textarea id="contenu" rows="4" placeholder="Contenu..."></textarea>
          <input id="media" type="file" accept="image/*,video/*">
          <input id="lien" type="url" placeholder="Lien externe (facultatif)">
        </div>
        <div style="display:flex; gap:8px; margin-top:10px;">
          <button class="btn primary" onclick="ajouterPost()">Publier</button>
          <button class="btn" onclick="logoutAdmin()">üö™ D√©connexion</button>
        </div>

        <div class="admin-management" id="admin-management" style="display:none;">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <strong>Gestion des administrateurs</strong>
            <small style="color:var(--muted)">Admins g√©r√©s localement (fichier unique)</small>
          </div>

          <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
            <input id="newAdminEmail" type="email" placeholder="Email admin">
            <input id="newAdminPass" type="password" placeholder="Mot de passe">
            <button class="btn" onclick="addAdmin()">‚ûï Ajouter</button>
          </div>

          <div class="admin-list" id="admin-list"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer stylis√© (Pens√©e Durable + Email) -->
  <footer>
    <div class="footer-inner">
      <div class="footer-brand">
        <div class="badge">Pens√©e Durable</div>
        <div style="font-weight:700">ONG √âcologique</div>
      </div>
      <div class="footer-contact">
        <span class="badge" style="background:#fff; padding:6px 10px; border-radius:999px; font-weight:700; margin-right:10px;">üìß</span>
        contact@pensee-durable.org
      </div>
    </div>
  </footer>

  <!-- Login Modal (simple) -->
  <div id="login-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.45); align-items:center; justify-content:center; z-index:10000;">
    <div style="background:var(--card); padding:18px; border-radius:12px; width:300px; box-shadow:0 10px 30px rgba(0,0,0,.25);">
      <h3 style="margin:0 0 8px">Connexion Admin</h3>
      <input id="login-email" type="email" placeholder="Email" style="width:100%; padding:8px; border-radius:8px; border:1px solid #dfece0; margin-bottom:8px;">
      <input id="login-pass" type="password" placeholder="Mot de passe" style="width:100%; padding:8px; border-radius:8px; border:1px solid #dfece0; margin-bottom:12px;">
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button class="btn" onclick="closeLogin()">Annuler</button>
        <button class="btn primary" onclick="performLogin()">Se connecter</button>
      </div>
    </div>
  </div>

  <script>
    /******************************
     * Configuration initiale
     * - listeAdminsDefault : admins embarqu√©s (email + password)
     * - stockage persistant : localStorage (clients peuvent ajouter admins)
     * ****************************/
    const LS_ADMINS_KEY = "pd_admins_v1";
    const LS_POSTS_KEY = "pd_posts_v1";
    const LS_LIKED_KEY = "pd_liked_v1";

    const listeAdminsDefault = [
      { email: "admin@pensee-durable.org", pass: "admin123", name: "Fondateur" }
      // tu peux ajouter d'autres admins par d√©faut ici
    ];

    /* Helpers stockage admins */
    function getStoredAdmins(){
      try{
        return JSON.parse(localStorage.getItem(LS_ADMINS_KEY)) || listeAdminsDefault.slice();
      }catch(e){ return listeAdminsDefault.slice(); }
    }
    function setStoredAdmins(arr){ localStorage.setItem(LS_ADMINS_KEY, JSON.stringify(arr)); }

    /* Posts + likes */
    function getPosts(){ return JSON.parse(localStorage.getItem(LS_POSTS_KEY) || "[]"); }
    function setPosts(arr){ localStorage.setItem(LS_POSTS_KEY, JSON.stringify(arr)); }
    function getLikedSet(){ return new Set(JSON.parse(localStorage.getItem(LS_LIKED_KEY) || "[]")); }
    function setLikedSet(s){ localStorage.setItem(LS_LIKED_KEY, JSON.stringify([...s])); }

    /* Utilitaires */
    const uid = ()=> Date.now().toString(36)+Math.random().toString(36).slice(2);
    const fmtDate = ts=>{ const d=new Date(ts); return d.toLocaleDateString()+" "+d.toLocaleTimeString().slice(0,5); }
    const escapeHtml = s => String(s||"").replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    const nl2br = s => (String(s||"").replace(/\n/g,"<br>"));

    /* Theme */
    function toggleTheme(){
      const root = document.documentElement;
      const current = root.getAttribute("data-theme") || "light";
      const next = current==="light" ? "dark" : "light";
      root.setAttribute("data-theme", next);
      localStorage.setItem("pd_theme", next);
    }
    (function applyStoredTheme(){
      const t = localStorage.getItem("pd_theme") || "light";
      document.documentElement.setAttribute("data-theme", t);
    })();

    /* RENDU des posts */
    function renderMedia(p){
      if(!p.media) return "";
      if(p.type==="image") return `<img src="${p.media}" alt="">`;
      return `<video controls src="${p.media}"></video>`;
    }
    function renderComments(list){
      if(!list || !list.length) return "";
      return list.map(c => `<div class="comment"><strong>Visiteur :</strong> ${escapeHtml(c)}</div>`).join("");
    }

    function afficherPosts(){
      const posts = getPosts();
      const liked = getLikedSet();
      const container = document.getElementById("posts");
      if(!posts.length){ container.innerHTML = "<p style='color:var(--muted)'>Aucune publication pour le moment.</p>"; return; }
      let html = "";
      posts.forEach(p => {
        const already = liked.has(p.id);
        html += `
          <div class="post" id="post-${p.id}">
            <div class="post-header"><span>üì¢ Publication</span><span>${fmtDate(p.createdAt)}</span></div>
            <h3>${escapeHtml(p.titre)}</h3>
            <p>${nl2br(escapeHtml(p.contenu))}</p>
            ${renderMedia(p)}
            ${p.lien ? `<p><a href="${escapeHtml(p.lien)}" target="_blank" rel="noopener">üîó Voir le lien</a></p>` : ""}
            <div class="post-actions">
              <button class="btn" onclick="likePost('${p.id}')" ${already ? "disabled":""}>‚ù§Ô∏è J'aime (${p.likes||0})</button>
              <button class="btn" onclick="toggleComment('${p.id}')">üí¨ Commenter</button>
              ${p.media? `<button class="btn" onclick="downloadMedia('${p.id}')">‚¨áÔ∏è T√©l√©charger</button>` : ""}
              <button class="btn" onclick="sharePost('${p.id}')">üîó Partager</button>
              ${window.__isAdmin ? `<button class="btn" onclick="supprimerPost('${p.id}')">üóë Supprimer</button>` : ""}
            </div>
            <div class="comments" id="comments-${p.id}">
              ${renderComments(p.comments)}
              <div class="comment-form" id="cform-${p.id}" style="display:none;">
                <input id="cinput-${p.id}" type="text" placeholder="√âcrire un commentaire‚Ä¶">
                <button class="btn primary" onclick="addComment('${p.id}')">Publier</button>
              </div>
            </div>
          </div>
        `;
      });
      container.innerHTML = html;
    }

    /* Cr√©ation / sauvegarde post */
    async function ajouterPost(){
      const titre = document.getElementById("titre").value.trim();
      const contenu = document.getElementById("contenu").value.trim();
      const fichier = document.getElementById("media").files[0];
      const lien = document.getElementById("lien").value.trim();

      if(!titre || !contenu){ alert("Titre et contenu obligatoires."); return; }

      const finalize = (dataURL, type, mime, ext) => {
        const posts = getPosts();
        posts.unshift({
          id: uid(), createdAt: Date.now(), titre, contenu,
          media: dataURL || null, type: type || null,
          mime: mime || null, ext: ext || null, lien: lien||null,
          likes: 0, comments:[]
        });
        setPosts(posts);
        document.getElementById("titre").value="";
        document.getElementById("contenu").value="";
        document.getElementById("media").value="";
        document.getElementById("lien").value="";
        afficherPosts();
        // scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      if(fichier){
        const reader = new FileReader();
        reader.onload = e => {
          const isImg = fichier.type.startsWith("image");
          const ext = guessExtFromMime(fichier.type);
          finalize(e.target.result, isImg ? "image":"video", fichier.type, ext);
        };
        reader.readAsDataURL(fichier);
      } else {
        finalize(null,null,null,null);
      }
    }

    function supprimerPost(id){
      if(!confirm("Supprimer cette publication ?")) return;
      const posts = getPosts().filter(p=>p.id!==id);
      setPosts(posts); afficherPosts();
    }

    /* Likes / Commentaires / Partage */
    function likePost(id){
      const posts = getPosts();
      const idx = posts.findIndex(p=>p.id===id); if(idx<0) return;
      const liked = getLikedSet();
      if(liked.has(id)) return;
      posts[idx].likes = (posts[idx].likes||0)+1;
      setPosts(posts);
      liked.add(id); setLikedSet(liked);
      afficherPosts();
    }
    function toggleComment(id){
      const f = document.getElementById("cform-"+id);
      if(!f) return;
      f.style.display = (f.style.display==="none"||f.style.display==="") ? "flex":"none";
      const inp = document.getElementById("cinput-"+id);
      if(inp) inp.focus();
    }
    function addComment(id){
      const inp = document.getElementById("cinput-"+id); if(!inp) return;
      const txt = inp.value.trim(); if(!txt) return;
      const posts = getPosts();
      const idx = posts.findIndex(p=>p.id===id); if(idx<0) return;
      posts[idx].comments = posts[idx].comments||[]; posts[idx].comments.push(txt);
      setPosts(posts); inp.value=""; afficherPosts(); toggleComment(id);
    }

    function sharePost(id){
      const url = location.origin + location.pathname + "#post-" + id;
      if(navigator.share){ navigator.share({ title: "Publication Pens√©e Durable", url }).catch(()=>{}); }
      else { navigator.clipboard?.writeText(url).then(()=>alert("Lien copi√©")); }
    }

    /* T√©l√©chargement dans stockage t√©l√©phone */
    async function downloadMedia(id){
      const p = getPosts().find(x=>x.id===id);
      if(!p || !p.media){ alert("Aucun m√©dia disponible."); return; }
      try{
        const blob = await getBlobFromPost(p);
        const filename = buildFilename(p, blob);
        if(window.showSaveFilePicker){
          const handle = await window.showSaveFilePicker({
            suggestedName: filename,
            types: [{ description: 'Fichier m√©dia', accept: { [blob.type || 'application/octet-stream']: ['.'+ (p.ext || guessExtFromMime(blob.type))] } }]
          });
          const writable = await handle.createWritable();
          await writable.write(blob); await writable.close();
          alert("Fichier enregistr√©.");
          return;
        }
        // fallback: anchor download
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
        alert("T√©l√©chargement lanc√© (v√©rifie le dossier T√©l√©chargements).");
      }catch(e){
        console.error(e); alert("Impossible de t√©l√©charger ici (limitation du navigateur).");
      }
    }

    async function getBlobFromPost(p){
      if(typeof p.media==="string" && p.media.startsWith("data:")) return dataURLToBlob(p.media);
      const res = await fetch(p.media); return await res.blob();
    }
    function dataURLToBlob(dataUrl){
      const [h,b] = dataUrl.split(','); const mime = (h.match(/data:(.*?);/)||[])[1]||"application/octet-stream";
      const bin = atob(b); const len = bin.length; const arr = new Uint8Array(len);
      for(let i=0;i<len;i++) arr[i]=bin.charCodeAt(i);
      return new Blob([arr],{type:mime});
    }
    function guessExtFromMime(m){
      if(!m) return "bin";
      const map = {"image/jpeg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif","video/mp4":"mp4","video/webm":"webm","video/ogg":"ogv"};
      return map[m]||"bin";
    }
    function buildFilename(p, blob){ const base=(p.titre||"media").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")||"media"; const ext = p.ext||guessExtFromMime(blob.type)||"bin"; const ts = new Date(p.createdAt||Date.now()).toISOString().slice(0,19).replace(/[:T]/g,"-"); return `${base}-${ts}.${ext}`; }

    /* ===== Admin auth & management (email+password) ===== */
    function openLogin(){ document.getElementById("login-modal").style.display="flex"; document.getElementById("login-email").focus(); }
    function closeLogin(){ document.getElementById("login-modal").style.display="none"; document.getElementById("login-email").value=""; document.getElementById("login-pass").value=""; }

    function performLogin(){
      const email = document.getElementById("login-email").value.trim().toLowerCase();
      const pass = document.getElementById("login-pass").value;
      const admins = getStoredAdmins();
      const found = admins.find(a=>a.email.toLowerCase()===email && a.pass===pass);
      if(found){
        window.__isAdmin = true;
        closeLogin();
        document.getElementById("admin-panel").style.display="block";
        document.getElementById("admin-management").style.display="block";
        renderAdminList();
        alert("Bienvenue admin: " + (found.name || found.email));
        afficherPosts();
      } else {
        alert("Identifiants incorrects.");
      }
    }

    function renderAdminList(){
      const wrap = document.getElementById("admin-list");
      const admins = getStoredAdmins();
      wrap.innerHTML = admins.map(a => `<div class="admin-badge">${escapeHtml(a.email)} <button class="btn" style="padding:4px 8px;margin-left:6px" onclick="removeAdmin('${a.email}')">üóë</button></div>`).join("");
    }

    function addAdmin(){
      const email = (document.getElementById("newAdminEmail").value || "").trim().toLowerCase();
      const pass = (document.getElementById("newAdminPass").value || "").trim();
      if(!email || !pass){ alert("Email et mot de passe requis."); return; }
      const admins = getStoredAdmins();
      if(admins.find(a=>a.email.toLowerCase()===email)){ alert("Cet email est d√©j√† admin."); return; }
      admins.push({ email, pass, name: email.split('@')[0] });
      setStoredAdmins(admins); renderAdminList();
      document.getElementById("newAdminEmail").value=""; document.getElementById("newAdminPass").value="";
      alert("Admin ajout√©.");
    }

    function removeAdmin(email){
      if(!confirm("Supprimer admin "+email+" ?")) return;
      let admins = getStoredAdmins().filter(a=>a.email.toLowerCase()!==email.toLowerCase());
      if(!admins.length){ alert("Au moins un admin requis."); return; }
      setStoredAdmins(admins); renderAdminList(); alert("Admin supprim√©.");
    }

    /* Init / migration */
    (function init(){
      // ensure admins stored
      if(!localStorage.getItem(LS_ADMINS_KEY)) setStoredAdmins(listeAdminsDefault.slice());
      // migrate posts (add ids if needed)
      const posts = getPosts().map(p=>({ id: p.id||uid(), createdAt: p.createdAt||Date.now(), likes:p.likes||0, comments:p.comments||[], ...p }));
      setPosts(posts); afficherPosts();
      // theme already applied earlier
    })();

    // close modal on backdrop click
    document.getElementById("login-modal").addEventListener("click", e => { if(e.target.id==="login-modal") closeLogin(); });

    /* small helpers for clipboard fallback */
    if(!navigator.clipboard){
      navigator.clipboard = { writeText: (t)=>{ return new Promise((res,rej)=>{ try{ const ta=document.createElement('textarea'); ta.value=t; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); res(); }catch(e){ rej(e);} }) } };
    }
  </script>
</body>
          </html>
